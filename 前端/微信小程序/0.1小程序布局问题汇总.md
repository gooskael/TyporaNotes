[TOC]

## 1.`wx:for`相关问题

### 1.1 `wx:for`嵌套循环：`wx:for-item` & `wx:for-index`

- [x] 问题产生原因：变量item和index复用。不指定的前提下，item表示本次循环的数据，index表示本次循环的下标。

- [x] 问题解决方案：使用`wx:for-item`和`wx:for-index`显式指明各自循环的名称。

- [x] 参考：[小程序多层嵌套wx:for](https://blog.csdn.net/zhanghuanhuan1/article/details/106186501/)：使用`wx:for-item`和`wx:for-index`指定各自的变量名称与index名称

​	1.在使用`wx:for`的时候，可以直接使用`item`和`index`获取循环的数据及下标

```html
<view wx:for="{{firstList}}" wx:key="index">{{item}}和{{index}}</view>
```

​	2.在使用嵌套`wx:for`循环的时候，因为初始的item和index名称都是一样的，因此是按照最近声明使用，及最靠近的一层`wx:for`的元素和下标。这时候如果想要用到外层的数据就没办法。因此这时候需要指定各自的item名称和下标index名称。

```html
<view wx:for="{{firstList}}" wx:for-item="first_item" wx:for-index="first_index" wx:key="first_index">
  <text>{{first_item.name}}</text>
  <text wx:for="{{first_item}}" wx:key="index">{{item}}</text>
</view>
```

```js
Page({
  data: {
    firstList: [
      {name: 'sam', tags: ['美丽', '大方', '智慧']},
      {name: 'peti', tags: ['稳重', '认真']}
    ],
  }
})
```

​	如上，那么就能实现上面的二维数组所有元素的展示了。

​	当然，其实最好的是第二层也显示指定好其item和index的名称。

```html
<view wx:for="{{firstList}}" wx:for-item="first_item" wx:for-index="first_index" wx:key="first_index">
  <text>{{first_item.name}}</text>
  <text wx:for="{{first_item}}" wx:for-item="second_item" wx:for-index="second_index" wx:key="second_index">{{second_item}}</text>
</view>
```

### 1.2 `wx:for`循环产生的元素`数据传递`及`内部组件特殊样式指定`(动态绑定class)

- [x] 问题产生原因：循环产生的元素在样式上是一致的，但是有时候希望某些元素有不一样的样式。并且有时候需要获取某一个元素的某些数据。
- [x] 问题解决方案：`data-name`传递参数，使用插值`{{}}`和三目运算符判断按需渲染。

​	1.`data-name`传递参数。

```html
<view wx:for="{{list}}" wx:key="index" bindtap="handleClick" data-index="{{index}}">{{item}}
</view>
<!-- 
data-index传过去的变量就是index
data-whatever传过去的变量就是whatever
data-realName传过去的变量就是realname (注意都是小写)
-->
```

```js
Page({
  data: {
    
  },
  
  handleClick(e) {
		// e.currentTarget.dataset.index 即从组件中传过来的参数 index
    // !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    // 需要注意的是，参数传过来之后全部都是小写，比如data-realName="{{item}}"
    // 接收的时候是e.currentTarget.dataset.realname
    // 因此建议都用小写，以免出错
    // !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    console.log(e); //下图是打印出来的数据
  },
})
```

<img src="/Users/samstephen/Library/Mobile Documents/com~apple~CloudDocs/TyporaNotes/前端/微信小程序/images/data-set.png" alt="image-20201220214918590" style="zoom:100%;" align='left'/>

****

​	2.循环内部元素指定特殊样式。**权重、状态管理数组及`wx:key`。**

​	关于制作日历、tag选中的整个过程，更加详细地见`0.2定制化组件汇总`。

​	为循环内部的某些组件指定特殊样式的核心在于：**使用插值`{{}}`和三目运算符判断按需渲染**。使用三目运算符是动态绑定class的第一种方式。

​	但是用来判断的这个变量的设计就比较重要。该判断变量主要是利用该组件的数据特殊性来形成，比如在生成一个日历之后，每一个日期的年月日构成了一个特殊字符，这个特殊字符有唯一性。这种方式我称之「**权重**」。

<img src="./images/calendar-image.png" alt="image-20210305222929508" style="zoom:50%;" align="left"/>

```html
<!-- 传递生成权重的数据 -->
<view class="calendar-card_content_view">
	<view 
	wx:for="{{monthList}}" 
	wx:for-item="date" 
	wx:for-index="date_index" 
	wx:key="date_index" 
        
	data-year="{{year}}" data-month="{{monthList_index+1}}" data-date="{{date}}"
	bindtap="chooseDate"
        
	class="{{preYear*10000+monthList_index*100+100+date*1 === startTimeWeight?'calendar-choosen-style':''}} {{preYear*10000+monthList_index*100+100+date*1 === endTimeWeight?'calendar-choosen-style':''}}" 
	>
	<text>{{date}}</text>
</view>
```

```css
.calendar-choosen-style {
  background: #F16969;
}
```

​	方便讲解，去掉其他比较复杂的，包括点击之后字体也应该变成白色；由于原理一样，这里就留下需要讲解的关于红色背景的部分。重点分成2步。第一步，生成权重；由于这里需要锁定起始、终止两个，因此要生成两个权重分别去对应；原理一致，只讲解起始。

```js
// page.js
Page({
  data: {
    // 权重
    startDateWeight: '',
    
    // 记录数据
    targetStartTime: '',
  },
  
  chooseDate(e) {
  	// 通过传递来的年月日生成一个唯一识别字符串
    var year = e.currentTarget.dataset.year;
		var month = e.currentTarget.dataset.month;
		var date = e.currentTarget.dataset.date;
    var time = year + '.' + month +'.'+ date;
    var timeWeight = year*10000 + month*100 + date*1; //e.g 20200102
    // 由于即时渲染，一定要用setData({})
    this.setData({
			targetStartTime: time,
			startTimeWeight: timeWeight,
		})
	},
})
```

​	使用`setData`改变了数据之后，前端中的插值语句就会即时判断，找到判断为true的组件中按需设定。`{{exp1?exp2:exp3}}`意思是：`exp1的判断为真假`？判断为真则执行`exp2`，判断为假则执行`exp3`。因此在唯一标识符相同的情况下，会设置其`class="calendar-choosen-style"`。

```html
<view
	class="{{year*10000+monthList_index*100+100+date*1 === startTimeWeight?'calendar-choosen-style':''}}">
</view>
```

​	可以看到日历由于选中的个数可以确定，只要两个（按需可能一个，日计划只要一个）。其个数是可以轻易穷举的，因此可以通过`if语句`来轻易判断。点击一次，就设置一下权重；如果再点击相同一个，就把权重置空。然而有一些不能确定的，比如有很多tag，点击选中之后就要记录其选中状态，被选中的tag个数不定，这时候就需要有一个「**状态管理数组**」。

​	

<img src="./images/tags-image.png" alt="image-20210305225812008" style="zoom:120%;" align="left"/>

```js
Page({
  data: {
    tags: ['招财体质', '打call狂人', '客户搬运工'],
    tagsStatus: [false, false, false],
    
    tagsChoosen: [],
		tagsColor: ['#F79306', '#C891E8', '#31BC95', '#E81E9C'],
  },
  
  // 生成同等长度数组 管理状态
  generateTagsStatus(tags) {
    var tagsStatus = [];
    for(let i=0; i<tagsStatus.length; i++) {
      tagsStatus.push(false);
    };
    return tagsStatus;
  },
  
  // 一般tags都会从后端获取，在获取的success里面生成更妥当
  getTagsDefault() {
    var that = this;
    wx.request({
      url: '....',
      success(res) {
				var status = that.generateTagsStatus(res.data.data);
        that.setData({
          tags: res.data.data,
          tagsStatus: status,
        })
      }
    })
  },
  
  // 获取被选取的tags => tagsChoosen
  getTagsChoosen() {
    var tagsChoosen = [];
    for(let i=0; i<tagsStatus.length; i++) {
      if(tagsStatus[i] === true) {
        tagsChoosen.push(this.data.tags[i]);
      }
      this.setData({
        tagsChoosen: tagsChoosen,
      });
    }
  },
})
```

```html
<text class="{{tagsStatus[index] === true?'choosen-tag':'not-choosen-tag'}}" style="border: 1px solid {{tagsColor[index]}}" wx:for="{{tags}}" wx:key="index"></text>
```

​	状态管理数组及生成一个和`wx:for="{{list}}"`中`list`同等长度的数组管理。注意要即时渲染，不然前端的变化不会即时更新。其中`style="border: 1px solid {{tagsColor[index]}}"`是动态绑定class的第二种方法，即先在`js文件`中定义好变量名，再直接插值渲染；第一种是**三目运算符**——归结起来都是**插值运算**。

###### Q：个人感觉`wx:key`也有用处，是不是就和权重一样？还是在js中可以锁定到这个元素进行改变，就跟设定了id一样？

****

### 1.3 `wx.for`中实现循环中`<image>`几张图片覆盖

<img src="/Users/samstephen/Library/Mobile Documents/com~apple~CloudDocs/TyporaNotes/前端/微信小程序/images/image标签for循环覆盖.png" alt="image-20210107152015049" style="zoom:50%;" align="left"/>

如上图，是三张图片的覆盖：金色外框（中空）、白色奖状内容、lock-icon。

> 金色边框的margin-top位移情况根据中空调整；
>
> lock-icon.png则要根据金色边框的高度进行调整（500rpx)。

```html
<view class="award-image-view">
	<image class="award-image-0" src="{{item.gloryUrl}}" data-item="{{item}}"
        style="filter: blur(3px);" bindtap="gotoAwardDetail"></image>
	<view style="margin-top: -470rpx; z-index:99;" >
		<image src="/images/award-border.png" style="width: 686rpx; height: 500rpx;"></image>  
	</view>
	<view style="margin-top: -500rpx; z-index: 999;">
		<image src="/images/lock-icon.png" style="width: 686rpx;"></image>  
	</view>
</view>
```

```css
/* 这里主要是把照片居中 */
.award-image-view {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  margin-top: 20rpx;
}

.award-image-0 {
  width: 650rpx;
  height: 460rpx;
}
```

1. 利用`margin-top = -470rpx`达到照片重叠的作用。这里要注意：最后的照片(即`lock-icon.png`)决定了下一个元素将从哪里开始计算。for循环产生的下一个元素的`top`将按照`lock-icon.png`所在的`view`的底部开始算。因此要保证`lock-icon`的图片大小覆盖了整个父级view。最好保证所有的覆盖照片的大小一致。
2. 模糊效果的`z-index`较高，因此如果不想白色奖状被金色边框的部分显露出来，就要用`z-index`管理好三张照片的层级。

​	对于第1点的解释，假如最后放置`lock-icon.png`大小较小的情况进行分析：

<img src="/Users/samstephen/Library/Mobile Documents/com~apple~CloudDocs/TyporaNotes/前端/微信小程序/images/multi-images.png" alt="image-20210107172336381" style="zoom:50%;" />

> 注意上图`lock-icon.png`所在的`<view>`作为最后一个，它的`bottom`就是下一个元素的`top`，因此会影响下一个view的`top`。如果想要下一个view的样式正常，那么就要注意照片的高度。因此最好使得所有的照片的大小一致。

​	这是理论上没有出现问题的情况，实际上把`<image>`放在`<view>`里的时候，会出现容器内部间隙：

<img src="/Users/samstephen/Library/Mobile Documents/com~apple~CloudDocs/TyporaNotes/前端/微信小程序/images/image-view-slot.png" alt="image-20210108230131718" style="zoom:50%;" align="left"/>

​	如上左图：`image`并没有完全填充整个`view`，那么使用`margin-top: minus rpx;`的时候就会产生不精确的覆盖，这个问题参考：[小程序 image跟view标签上下会有间隙](https://www.jianshu.com/p/dc590c9b2695)。在`image`中设置`display: block` 或者`vertical-align: bottom`即可。抑或者在`view`中设置 `font-size: 0`。关于`vertical-align`更加详细的解读，参考`../css/0.css问题汇总.md/6.vertical-align怎么使用？`。

> 底边产生间隔的原因：图片文字等inline元素默许是跟父级元素内容的baseline（默认为元素的底）对齐，而baseline又和父级底边有必定间距。
>
> <img src="/Users/samstephen/Library/Mobile Documents/com~apple~CloudDocs/TyporaNotes/前端/微信小程序/images/image-bottom-gap.png" alt="image-20210122172518906" style="zoom:50%;" align="left"/>
>
> 另一种现象是，几个元素排列的时候，左右会有间隔（如上图text和右侧有间隔），原因是：这个问题产生的原因是换行引起的，因为我们写标签时通常会在标签结束符后顺手打个回车，而回车会产生回车符，回车符相当于空白符，通常情况下，多个连续的空白符会合并成一个空白符，而产生“空白间隙”的真正原因就是这个让我们并不怎么注意的**空白符**。因此设置`font-size: 0`，让这些空白符也不占位置即可。

```css
/* wxss */
.image {
  display: block;
}

.image {
  vertical-align: bottom;
}

.view {
  font-size: 0;
}
```

### 







****

## 2.`textarea`相关







## 3.`scroll-view`相关

### 3.1 取消侧边滚动条

​	参考[微信小程序 -- 去掉scroll-view滚动条（测试有效）](https://blog.csdn.net/qq_41638795/article/details/98172326)，直接设置其css样式即可。

```css
scroll-view ::-webkit-scrollbar {
  width: 0;
  height: 0;
  color: transparent;
  display: none;
}

/* 注意::前面的空格 */
```

****

### 3.2