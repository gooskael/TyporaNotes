

[TOC]

参考：[mock.js的使用方法](https://www.jianshu.com/p/f3adb1aab09e)、[mock官方指南](https://github.com/nuysoft/Mock/wiki/Getting-Started)、

# 1. 快速使用

## 0. 配置 axios

​	由于要搭配 axios 使用，先配置axios。

```shell
$ npm install --save axios vue-axios
```

```js
// 在main.js 中引入引入vue和axios，挂载原型
import Vue from 'vue'
import axios from 'axios'
import VueAxios from 'vue-axios'

Vue.use(VueAxios, axios)
Vue.prototype.$axios = axios
```

## 1. 配置 mock.js

```shell
$ npm install mockjs --save-dev
```

```js
// 和main.js同目录创建mock.js
import Mock from 'mockjs'

const template = {
  "mtime": "@datetime",//随机生成日期时间
  "score|1-800": 800,//随机生成1-800的数字
  "rank|1-100": 100,//随机生成1-100的数字
  "stars|1-5": 5,//随机生成1-5的数字
  "nickname": "@cname",//随机生成中文名字
}

Mock.mock('/mock/mocksomething', /post|get/i, template)
```

```js
// main.js中引入
require('./mock')
```

```js
// anyvue.vue
getMockData() {
  url = '/mock/mocksomething'; // mock的路径，与上面保持一致
  this.$axios.get(url)
  .then((res) => {
		console.log(res, 'mock data');
  })
 	.catch((err) => {
    
  })
}
```

# 2. 模版(template)语法规范

​	用法是：`name|rule: value`。

## 2.1 String

```js
'name|count': string // 重复count次string生成
'name|min-max': string // 重复[min, max]次string生成

// e.g
'article|2': 'this is an article ' // this is an article this is an article
```

## 2.2 Number

```js
'name|+step': number // 1.初始值为number，每次生成都根据上次状态+step
'name|min-max': number // 2.取[min, max]范围内的值; number无用，只是用来确定类型

// 3.第一部分min-max和[2.]相同，也可以设置一个确定的数字，表示整数位固定
// 第二部分dmin-dmax指小数位的个数，设置一个确定的数字表示小数位个数固定
'name|min-max.dmin-dmax': number //

// e.g
'number0|+2': 1 // 1，后面生成的即为3,5···
'number1|9.3': 1 // 9.423
'number2|1-10.1-10': 8.2432132
```

## 2.3 Boolean

```js
'name|1': boolean // true｜false的概率为1/2
'name|min-max': value // value占min, !value占max

// e.g.
'quarter|1-3': true // true为1/4, false为3/4
```

## 2.4 Object

```js
'name|count': object // 从object中随机选取count个属性
'name|min-max': object // 从object中随机选取[min, max]个属性
```

## 2.5 Array

```js
'name|1': array // 从array中随机选取一个元素
'name|+1': array // 从array中顺序选取一个元素
'name|count': array // 重复count次array拼接成新的数组返回
'name|min-max': array // 重复[min, max]次array拼接成新的数组返回
```

## 2.6 Function

```js
'name': function // 取function的返回值作为属性值
```

## 2.7 RegExp

```js
'name': regexp // 根据正则语法生成可以匹配它的字符串

// e.g.
'regexp': /[a-z][A-Z][0-9]/, // fD4
```

## 2.8 占位符 `@`

​	占位符引用的是 `Mock.Random` 中的方法，可以通过 `Mock.Random.extend()` 来扩展自定义占位符（优先级更高）。常用的占位符参考：[mock、数据常用占位符](https://blog.csdn.net/weixin_47426048/article/details/107858058)、[Mock常用占位符一览](https://www.cnblogs.com/kreo/p/11733424.html)、[mock.js教程值数据占位符定义规范](https://blog.csdn.net/qq_45040919/article/details/110449677)。

```js
const template = {
  'first': '@first', // 随机生成一个英文的名
  'last': '@last', // 随机生成一个英文的姓
  'full': '@first @last', // 优先级为自定义的最高
}

Mock.mock(template);
// first: Michael
// last: Lewis
// full: Michael Lewis
```

****

# 3. Mock.mock()

​	`Mock.mock()` 的用法有五种，主要区别是参数是使用函数返回值还是模版。

```js
Mock.mock( rurl?, rtype?, template|function( options ) )

// 1. rurl: 表示需要拦截的URL，可以是字符串或URL正则。
Mock.mock( '/domain/list.json', ···, ··· )
Mock.mock( /\/mock\/mocksomething/, ···, ··· )

// 2. rtype: 表示需要拦截的Ajax请求类型。如GET, POST, PUT, DELETE
Mock.mock( '/domain/list.json', 'get', ··· )
Mock.mock( '/domain/list.json', /get|post/i, ··· ) // /get|post/i表示不区分大小写

// 3.1 template: 表示数据模版
// 3.2 function: 用于生成响应数据的函数
```

## 3.1 Mock.mock( template )

```js
import Mock from 'mockjs'
// 根据模版生成数据
const template = {
  'full': '@first @last'
}
let data = Mock.mock(template);
```

## 3.2 Mock.mock( rurl, template|function )

```js
import Mock from 'mockjs'
// 当拦截到匹配的`rurl`时，根据模版生成数据
const template = {
  'full': '@first @last'
}
Mock.mock('/api/getFullname', template)

// 当拦截到匹配的`rurl`时，根据函数生成数据
const Random = Mock.Random
const mockData = () => {
  return {
    fullname: Random.name()
  }
}
Mock.mock('/api/getFullname', mockData)
```

## 3.3 Mock.mock( rurl, rtype, template|function)

```js
Mock.mock('/api/getFullname', 'post', template);
Mock.mock('/api/getFullname', /post|get/i, template);

Mock.mock('/api/getFullname', /post|get/i, function);
```

****

# 4. Mock.valid( template, data)

​	用来校验真实数据 `data` 是否与数据模版 `template` 匹配。参考：[mock的使用](https://www.jianshu.com/p/e0c2928ab270)、[mockjs 使用以及反向校验](https://www.cnblogs.com/linjunfu/p/11379021.html)。

```js
// 匹配则返回空数组
// 不匹配则返回不匹配的细节
var template = {
    name: 'value1'
}
var data = {
    name: 'value2'
}
Mock.valid(template, data)
```

****

